# Picoでゲームボーイを作ろう！
## はじめに
本書では、RaspberryPi Picoを使用してゲームボーイのエミュレータを作る方法について解説します。以下の画像は、筆者が実際に作製したものとなります。何か虚無感の様なものが漂っていますね…

![image](/chapter0/image/1.jpg)
*テトリスのデモ画面*

## 必要なスキル
本書を読み進める上で、必要であるスキルは以下の通りです。

- C/C++の実用的な技能（Hello World程度では厳しいです！）
- アセンブリの経験
- CPUの仕組みを理解
- 英文読解

CPUの仕組みを理解することが本書の目的ではありませんので、自信の無い方は必要に応じて以下の書籍等で学習することをお勧めします。

- CPUの創りかた
- 例の本
- 例の本

## 大まかな作成手順
実際にはかなりの紆余曲折がありましたが、無駄な手順を除くと以下の様な流れとなります。

1. ゲームボーイROM吸い取り器の作成
2. ROMヘッダのパーサ作成
3. bootstarapの理解
4. 命令の実装１（bootstarap実行に必要もののみ）
5. SPI仕様の理解
6. PICO 1.3 LCDの仕様
7. PICO 1.3 LCD用デバイスドライバの作成
8. PPUのBGのみ実装
9. デバッグ機能の実装
10. 命令を実装２
11. DMAの実装
12. タイマー及び関連の割り込み
13. PPU及び関連の割り込み
14. 再度各種test ROMによる動作確認
15. キー及び関連の割り込み
16. 最適化

わずか16ステップで完成です。本書では、それぞれのステップにつき目標を設定しますので、机上の空論としては無理なく製作を進めることが出来る筈です。

!!! warning 長過ぎる補足
    実は、今回の作製には紆余曲折がありました。そもそも当初の目標では、Arduino Mega 2560 R3により、実カートリッジを読み込んで動作する互換機の作成を考えていました。少しでも経験のある方であればすぐに分かるとは思いますが、明らかにゲームボーイを動作させるには性能が足りません。しかしながら、筆者はエミュレータを作製した経験がなく、またボードが自宅に転がっていたために何となく利用することにしました。

    そのため、途中でRAMの容量の不足に気付いた際は、これを補うためにSRAMを外付けする等、かなり虚無なことに手を付けてしまっていました。こうなると引き下がれず、数々の無意味な延命処置に手を付けていました。結局、bootstrapの起動により「Nintendo」のロゴまでは確認できたのですが、これ以上はどう頑張っても不可能であると気付きました。

    一度はあきらめたのですが、より安価でかつ高性能なRaspberry Pi Picoの存在を知り、Picoでの開発に急遽切り替えました。確かにpicoはArduinoに比べると大変に高性能なのですが、残念ながら開発環境の構築に難があり、それなりに面倒な部分があります。しかしながら、Picoは公式のSDKにも対応したArduino IDEにより開発することもできるのです。色々と不足する部分はあるのですが、Arduino Mega 2560で書いたソースコードの大部分を流用できることが最大の魅力で、使い慣れていることもメリットでした。そのため、本書で紹介する手順は、良くも悪くも過去の経緯を引きずっています。恐らく他により良い方法があると思います。

    ![image](/chapter0/image/2.jpg)*虚無の残骸*

## 必要なもの
以下は、作製に必要なものです。

- Raspberry Pi Pico（760円@秋月電子通商）
- Raspberry Pi Pico用 1.3インチ 液晶モジュール 240×240（1353円@switch science）
- Arduino Mega 2560
- カートリッジコネクタ（ゲームボーイカセット端子用）
- 開発用端末（Arduino IDEが利用できるPC）
- ゲームボーイカートリッジ

!!! note Arduino IDEとボードについて
    Arduino IDEについては、現在1.8系統と2.0系統の両方が存在しますが、いずれを利用しても問題ありませんが、開発環境として設定するボードには、Arduino公式のものではなくearlephilhower氏の開発したものを利用します。詳細は後ほど説明します。

## その他
何かあるなら加筆